YAHOO=(typeof YAHOO==="undefined")?{}:YAHOO;YAHOO.JP=(typeof YAHOO.JP==="undefined")?{}:YAHOO.JP;YAHOO.JP.mempf=(typeof YAHOO.JP.mempf==="undefined")?{}:YAHOO.JP.mempf;YAHOO.JP.mempf.mhd=(typeof YAHOO.JP.mempf.mhd==="undefined")?{positions:"",initPositions:"",metaPositions:"",service:"",from:"mhd",initMods:[],metaMods:[],timeoutms:1800,timeoutid:null,complete:false,getPaths:["reservation.yahoo.co.jp"],requestHost:"https://mempf.yahoo.co.jp/v2/offer",metaPositionPropertyName:"yjmempf:positions",metaPagePropertyName:"yjmempf:page",_clickLogAttribute:"data-mempf-lk",_clickLogToken:"8dec6df6-7d6e-4085-b834-5afb49ed6c82",_clickLogProject:"mempf",_clickLogDataset:"mempf_dsb_log",_clickLogRequiredKeys:["pid","sid","oid","aid","url","pos"],_rdrHostName:"rdr.yahoo.co.jp",_rdsigHostName:"rdsig.yahoo.co.jp",getService:function(){var d=location.hostname;var b=false;var g=YAHOO.JP.mempf.mhd.getPaths;for(var a=0;a<g.length;a++){if(d.indexOf(g[a])>=0){b=true;break}}var c="";if(b){var e=location.pathname.slice(1).slice(0,-1).split("/");if(e.length>0){c=e[0]}}else{var f=d.replace(".yahoo.co.jp","").split(".");if(f.length>0){c=f[f.length-1]}}return c},init:function(h){if(YAHOO.JP.mempf.mhd.complete==true){return}YAHOO.JP.mempf.mhd.initPositions=h;var f=YAHOO.JP.mempf.mhd.getMetaContentByProperty(YAHOO.JP.mempf.mhd.metaPositionPropertyName);YAHOO.JP.mempf.mhd.metaPositions=f;if(f){h=h?h+","+f:f}YAHOO.JP.mempf.mhd.positions=h;if(h==undefined||h==""){return}YAHOO.JP.mempf.mhd.service=YAHOO.JP.mempf.mhd.getService();YAHOO.JP.mempf.mhd.timeoutid=window.setTimeout(function(){if(YAHOO.JP.mempf.mhd.complete==false){document.body.dispatchEvent(YAHOO.JP.mempf.mhd.createEvent("yjmempfMhdInitialized"));window.clearTimeout(YAHOO.JP.mempf.mhd.timeoutid);YAHOO.JP.mempf.mhd.timeoutid=null}},YAHOO.JP.mempf.mhd.timeoutms);YAHOO.JP.mempf.mhd.service=YAHOO.JP.mempf.mhd.getService();var i=new Date();var b=i.getTime();var a=YAHOO.JP.mempf.mhd.chkWebview();var g=YAHOO.JP.mempf.mhd.getMetaContentByProperty(YAHOO.JP.mempf.mhd.metaPagePropertyName);var e=YAHOO.JP.mempf.mhd.requestHost+"?position="+h+"&webview="+a+"&service="+YAHOO.JP.mempf.mhd.service+"&from="+YAHOO.JP.mempf.mhd.from+"&page="+g+"&t="+b;var c=new XMLHttpRequest();c.open("GET",e,true);c.withCredentials=true;c.timeout=YAHOO.JP.mempf.mhd.timeoutms;c.onload=function(){if(c.status===200&&YAHOO.JP.mempf.mhd._isJson(c.responseText)){YAHOO.JP.mempf.mhd.exec(JSON.parse(c.responseText))}};c.send(null)},exec:function(y){if(YAHOO.JP.mempf.mhd.timeoutid==null){return}var f=YAHOO.JP.mempf.mhd.positions.split(",");var m=YAHOO.JP.mempf.mhd.initPositions.toLowerCase().split(",");var a=YAHOO.JP.mempf.mhd.metaPositions.toLowerCase().split(",");var e={INIT:1,META:2};var c=f.length;for(var p=0;p<f.length;p++){var x=f[p].toLowerCase();var v=null;var n="";for(var z in y){if(z.toLowerCase()==x){v=z}if(m&&m.indexOf(x)>=0){n=e.INIT}else{if(a&&a.indexOf(x)>=0){n=e.META}}}if(v==null){continue}var q=y[v].contents;var s=null;var g=y[v].click_base_param;if(q.length==1){if(document.getElementById(x+"-content1")!=null){s=document.getElementById(x+"-content1");s.innerHTML=q[0];if(n===e.INIT){YAHOO.JP.mempf.mhd.initMods.push(x+"-content1")}else{if(n===e.META){YAHOO.JP.mempf.mhd.metaMods.push(x+"-content1")}}YAHOO.JP.mempf.mhd.scriptExec(x+"-content1");YAHOO.JP.mempf.mhd._listenClickEvent(s,x,g)}else{if(document.getElementById(x)!=null){s=document.getElementById(x);s.innerHTML=q[0];if(n===e.INIT){YAHOO.JP.mempf.mhd.initMods.push(x)}else{if(n===e.META){YAHOO.JP.mempf.mhd.metaMods.push(x)}}YAHOO.JP.mempf.mhd.scriptExec(x);YAHOO.JP.mempf.mhd._listenClickEvent(s,x,g)}}}else{if(q.length>1){for(var o=0;o<q.length;o++){var b=o+1;if(document.getElementById(x+"-content"+b)!=null){s=document.getElementById(x+"-content"+b);s.innerHTML=q[o];if(n===e.INIT){YAHOO.JP.mempf.mhd.initMods.push(x+"-content"+b)}else{if(n===e.META){YAHOO.JP.mempf.mhd.metaMods.push(x+"-content"+b)}}YAHOO.JP.mempf.mhd._listenClickEvent(s,x,g)}else{if(o==0&&document.getElementById(x)!=null){s=document.getElementById(x);s.innerHTML=q[o];if(n===e.INIT){YAHOO.JP.mempf.mhd.initMods.push(x)}else{if(n===e.META){YAHOO.JP.mempf.mhd.metaMods.push(x)}}YAHOO.JP.mempf.mhd._listenClickEvent(s,x,g)}}}}}if(s!=null){var u=new Date();var k=u.getTime();var r=y[v].beacon_url;if(r){var w=YAHOO.JP.mempf.mhd._createBeacon(r,k);s.appendChild(w)}var h=y[v].imps_base_url;if(h){var l=YAHOO.JP.mempf.mhd._createTPBeacon(h);s.appendChild(l)}}c--;if(c<=0){break}}YAHOO.JP.mempf.mhd.complete=true;if(YAHOO.JP.mempf.mhd.timeoutid!=null){window.clearTimeout(YAHOO.JP.mempf.mhd.timeoutid);YAHOO.JP.mempf.mhd.timeoutid=null;document.body.dispatchEvent(YAHOO.JP.mempf.mhd.createEvent("yjmempfMhdInitialized"))}},_createBeacon:function(c,b){var a=document.createElement("img");a.src=c+"&service="+YAHOO.JP.mempf.mhd.service+"&t="+b;a.style.display="none";return a},_createTPBeacon:function(b){var a=document.createElement("img");a.src=b+"&location="+location.hostname+"&fromjs="+YAHOO.JP.mempf.mhd.from;a.style.display="none";return a},createEvent:function(b){var a=null;try{a=new CustomEvent(b)}catch(c){a=document.createEvent("Event");a.initEvent(b,true,true)}return a},chkWebview:function(){var a=window.navigator||{};var b=a.userAgent||"";if(b.indexOf("YJApp-IOS")!==-1){return 1}return 0},scriptExec:function(m){var h=document.getElementById(m);var b=h.getElementsByTagName("script");var g=b.length;for(var f=0;f<g;f++){var k=document.createElement("script");k.innerHTML=b[f].innerHTML;var d=b[f].attributes;for(var c=0;c<d.length;c++){k.setAttribute(d[c].name,d[c].value)}b[f].classList.add("matilda_remove_script");b[f].parentNode.appendChild(k)}var l=document.getElementsByClassName("matilda_remove_script");for(var a=0;a<g;a++){var e=l[0];e.parentNode.removeChild(e)}},getMetaContentByProperty:function(b){var a=document.head.children;var d="";for(var c=0;c<a.length;c++){if(a[c].getAttribute("property")===b&&typeof a[c].getAttribute("content")!==undefined){d=a[c].getAttribute("content");break}}return d},_listenClickEvent:function(h,j,k){if(!h){return}if(!j){return}if(!k){return}var b=h.getElementsByTagName("a");var e=b?b.length:0;for(var l=0;l<e;l++){var d={};var o=Object.keys(k);for(var g=0;g<o.length;g++){var n=o[g];d[n]=k[n]}var m=YAHOO.JP.mempf.mhd._getPositionIndex(j,b[l],l);if(!m){continue}d.pos=String(m);var a=b[l].getAttribute("href");if(!a){continue}d.url=btoa(unescape(encodeURIComponent(a)));var c=b[l].getAttribute(YAHOO.JP.mempf.mhd._clickLogAttribute);if(c!==null){d=YAHOO.JP.mempf.mhd._appendClickLogParamByElemAttributeString(d,c)}var f=YAHOO.JP.mempf.mhd._createClickLogRequestData(d);f=YAHOO.JP.mempf.mhd._validateClickLogRequestData(f);if(f===false){continue}YAHOO.JP.mempf.mhd._setClickEvent(b[l],f)}},_getPositionIndex:function(b,c,a){if(document.getElementById(b)!=null){return a+1}else{return YAHOO.JP.mempf.mhd._getAnchorIndexFromMultiContents(b,c)}},_getAnchorIndexFromMultiContents:function(b,e){var h=document.querySelectorAll("[id^='"+b+"-content']");var a=1;for(var f=0;f<h.length;f++){var g=h[f].getElementsByTagName("a");var d=g?g.length:0;for(var c=0;c<d;c++){if(g[c].isEqualNode(e)){return a}a=a+1}}return false},_setClickEvent:function(c,a){if(c.isMempfClickEventAttached!=true){var b=YAHOO.JP.mempf.mhd._clickEvent.bind(YAHOO.JP.mempf.mhd,a);c.addEventListener("click",b);c.isMempfClickEventAttached=true}},_clickEvent:function(a,b){YAHOO.JP.mempf.mhd._sendClickLog(a)},_appendClickLogParamByElemAttributeString:function(e,f){var d={};if(!f){return e}if(!(f.length>=3&&f.length<=1024)){return e}f.split(";").map(function(g){return g.split(":")}).filter(function(g){return g.length===2&&g[1]!==""}).reduce(function(g,h){g[h[0]]=h[1];return g},d);var a=Object.keys(d);if(!(a.length>=1&&a.length<=32)){return e}for(var c=0;c<a.length;c++){var b=a[c];e[b]=d[b]}return e},_createClickLogRequestData:function(a){return{tk:YAHOO.JP.mempf.mhd._clickLogToken,r:[{p:YAHOO.JP.mempf.mhd._clickLogProject,d:YAHOO.JP.mempf.mhd._clickLogDataset,data:a}]}},_validateClickLogRequestData:function(e){if(!e.r[0]){return false}var d=e.r[0].data;var m=Object.keys(d);var l=/^[a-z][0-9a-z_]*$/;var f=/^[0-9a-zA-Z_-]*$/;var n=/^[0-9a-zA-Z_]*$/;var j=/^[0-9a-zA-Z/+=]*$/;for(var g=0;g<m.length;g++){if(!d[m[g]]){delete d[m[g]];continue}if(typeof d[m[g]]!=="string"){delete d[m[g]];continue}if(!l.test(m[g])){delete d[m[g]];continue}if(m[g]!=="url"&&m[g]!=="pid"&&!f.test(d[m[g]])){delete d[m[g]];continue}if(m[g]==="pid"&&!n.test(d[m[g]])){delete d[m[g]];continue}if(m[g]==="url"&&!j.test(d[m[g]])){delete d[m[g]];continue}if(m[g]==="url"){try{var b=new URL(atob(d[m[g]]));var h=new RegExp("/p="+YAHOO.JP.mempf.mhd._clickLogProject+"/");var a=new RegExp("/"+YAHOO.JP.mempf.mhd._clickLogProject+"/");if(b.hostname===YAHOO.JP.mempf.mhd._rdrHostName&&h.test(b.pathname)){delete d[m[g]];continue}else{if(b.hostname===YAHOO.JP.mempf.mhd._rdsigHostName&&a.test(b.pathname)){delete d[m[g]];continue}}}catch(k){}}if(m[g].length<1||m[g].length>16){delete d[m[g]];continue}if(m[g]!=="url"&&(d[m[g]].length<1||d[m[g]].length>32)){delete d[m[g]];continue}}m=Object.keys(d);var c=YAHOO.JP.mempf.mhd._clickLogRequiredKeys;for(var g=0;g<c.length;g++){if(m.indexOf(c[g])==-1){return false}}e.r[0].data=d;return e},_sendClickLog:function(b){var a="https://dsb.yahoo.co.jp/api/v1/stream";if(navigator.sendBeacon){YAHOO.JP.mempf.mhd._sendClickLogBeacon(a,b)}else{YAHOO.JP.mempf.mhd._sendClickLogXhr(a,b)}},_sendClickLogBeacon:function(a,c){var b=JSON.stringify(c);navigator.sendBeacon(a,b)},_sendClickLogXhr:function(a,d){var b=JSON.stringify(d);var c=new XMLHttpRequest();c.open("POST",a,true);c.withCredentials=true;c.setRequestHeader("Content-Type","application/json");c.send(b)},_isJson:function(b){try{JSON.parse(b)}catch(a){return false}return true}}:YAHOO.JP.mempf.mhd;